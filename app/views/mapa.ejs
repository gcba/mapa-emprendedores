<!DOCTYPE html>
<html>
	<head>
	<title><%= title %></title>
	<link rel='stylesheet' href='/stylesheets/style.css' />
	<script src="http://localhost:3000/socket.io/socket.io.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />

	</head>
	<body>
		<div id="map"></div>


		<div id="controles">
		</div>


	<script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
	<script>
		var sublayer;
		var main = function(){
		
			$('#map').css('cursor', 'progress');
			var tiempo_de_refresh = 1000 * 60; //1 minuto

			var map = new L.Map('map', {
				zoomControl: false,
				center: [-34.622, -58.414],
				zoom: 12
			});

		    L.tileLayer('https://a.tiles.mapbox.com/v3/gcbadata.acde275e/{z}/{x}/{y}.png', {
		    	attribution: "<a href='https://www.mapbox.com/about/maps/' target='_blank'>&copy; Mapbox &copy; OpenStreetMap</a> <a class='mapbox-improve-map' href='https://www.mapbox.com/map-feedback/' target='_blank'>Improve this map</a>"
		    }).addTo(map);

		    cartodb.createLayer(map, 'http://apagones.cartodb.com/api/v2/viz/d082feae-4f29-11e4-a794-0e018d66dc29/viz.json',{ refreshTime: tiempo_de_refresh })
			 	.addTo(map)
			 	.on('done', function(layer){

			 	sublayer = layer;
			 	layer.getSubLayer(1).hide();

				$('#map').css('cursor', 'pointer');
				
				layer.setInteraction(true);

				layer.on('featureOver', function(e, pos, latlng, data) {
					// console.log(e, pos, latlng, data);
				});

				layer.on('refresh', function(e) {
					//console.log("e, pos, latlng, data");
				});


				layer.on('error', function(err) {
					console.log("Error de capa: " +  err)
			    });

			}).on('error', function() {
				console.log("Ocurri√≥ un error al cargar el mapa");
			});
		
		};

	  window.onload = main;
	</script>

	</body>
</html>